<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>17 ã€æ–‡ä»¶ä¸Šä¼ ã€‘ | Aismy&#39;Docs</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Aismy&#39;Docs">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.906cd319.css" as="style"><link rel="preload" href="/assets/js/app.b738e2cf.js" as="script"><link rel="preload" href="/assets/js/2.ffb45a81.js" as="script"><link rel="preload" href="/assets/js/5.58eac4fd.js" as="script"><link rel="prefetch" href="/assets/js/10.c2e0087a.js"><link rel="prefetch" href="/assets/js/11.515afe89.js"><link rel="prefetch" href="/assets/js/12.fab2a176.js"><link rel="prefetch" href="/assets/js/13.001935e7.js"><link rel="prefetch" href="/assets/js/14.b80dbf2e.js"><link rel="prefetch" href="/assets/js/15.1b1059f6.js"><link rel="prefetch" href="/assets/js/16.fcd1537c.js"><link rel="prefetch" href="/assets/js/17.9df6cc33.js"><link rel="prefetch" href="/assets/js/18.bd3b4e60.js"><link rel="prefetch" href="/assets/js/19.c0b3ce9a.js"><link rel="prefetch" href="/assets/js/20.546547fb.js"><link rel="prefetch" href="/assets/js/21.0692e109.js"><link rel="prefetch" href="/assets/js/22.941054f1.js"><link rel="prefetch" href="/assets/js/23.6a79feac.js"><link rel="prefetch" href="/assets/js/24.d7b40265.js"><link rel="prefetch" href="/assets/js/25.2f068444.js"><link rel="prefetch" href="/assets/js/26.39e773a6.js"><link rel="prefetch" href="/assets/js/27.0cc11d71.js"><link rel="prefetch" href="/assets/js/28.6e0bab80.js"><link rel="prefetch" href="/assets/js/29.aa305b1a.js"><link rel="prefetch" href="/assets/js/3.166f9e48.js"><link rel="prefetch" href="/assets/js/30.a9437cbd.js"><link rel="prefetch" href="/assets/js/31.d2300f1b.js"><link rel="prefetch" href="/assets/js/32.30060633.js"><link rel="prefetch" href="/assets/js/33.ddd9f9e8.js"><link rel="prefetch" href="/assets/js/34.102c62c1.js"><link rel="prefetch" href="/assets/js/35.da833d69.js"><link rel="prefetch" href="/assets/js/36.b4b83ef9.js"><link rel="prefetch" href="/assets/js/37.a549e9e3.js"><link rel="prefetch" href="/assets/js/38.e84bf93e.js"><link rel="prefetch" href="/assets/js/39.145b375f.js"><link rel="prefetch" href="/assets/js/4.2988106a.js"><link rel="prefetch" href="/assets/js/40.246cd152.js"><link rel="prefetch" href="/assets/js/41.530026b3.js"><link rel="prefetch" href="/assets/js/42.24a60b39.js"><link rel="prefetch" href="/assets/js/43.902a7b0b.js"><link rel="prefetch" href="/assets/js/44.4f8c78f2.js"><link rel="prefetch" href="/assets/js/6.d50e78bb.js"><link rel="prefetch" href="/assets/js/7.977fe42a.js"><link rel="prefetch" href="/assets/js/8.289b9caf.js"><link rel="prefetch" href="/assets/js/9.6a3fba9d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.906cd319.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Aismy'Docs" class="logo"> <span class="site-name can-hide">Aismy'Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="https://www.aismy.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“•åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸµJava SE" class="dropdown-title"><a href="/pages/389d93/" class="link-title">ğŸµJava SE</a> <span class="title" style="display:none;">ğŸµJava SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/389d93/" class="nav-link">JavaåŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/pages/aab896/" class="nav-link">é›†åˆ</a></li><li class="dropdown-item"><!----> <a href="/pages/d2a30d/" class="nav-link">IOæµ</a></li><li class="dropdown-item"><!----> <a href="/pages/780f7d/" class="nav-link">æ³¨è§£å’Œåå°„</a></li><li class="dropdown-item"><!----> <a href="/pages/8d2bfc/" class="nav-link">å¹¶å‘ç¼–ç¨‹</a></li><li class="dropdown-item"><!----> <a href="/pages/e9d599/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/467393/" class="nav-link">æ–°ç‰¹æ€§</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸŒ´æ•°æ®åº“" class="dropdown-title"><a href="/pages/142be7/" class="link-title">ğŸŒ´æ•°æ®åº“</a> <span class="title" style="display:none;">ğŸŒ´æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/142be7/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/1ce2e2/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/62a615/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><a href="/pages/1b02d4/" class="nav-link">ğŸš€åç«¯æ¡†æ¶</a></div><div class="nav-item"><a href="/pages/1fe252/" class="nav-link">ğŸš€å‰ç«¯æŠ€æœ¯</a></div><div class="nav-item"><a href="/pages/83c955/" class="nav-link">ğŸ› ï¸å¼€å‘å·¥å…·</a></div> <a href="https://github.com/Aismy/aismy.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="https://www.aismy.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“•åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸµJava SE" class="dropdown-title"><a href="/pages/389d93/" class="link-title">ğŸµJava SE</a> <span class="title" style="display:none;">ğŸµJava SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/389d93/" class="nav-link">JavaåŸºç¡€</a></li><li class="dropdown-item"><!----> <a href="/pages/aab896/" class="nav-link">é›†åˆ</a></li><li class="dropdown-item"><!----> <a href="/pages/d2a30d/" class="nav-link">IOæµ</a></li><li class="dropdown-item"><!----> <a href="/pages/780f7d/" class="nav-link">æ³¨è§£å’Œåå°„</a></li><li class="dropdown-item"><!----> <a href="/pages/8d2bfc/" class="nav-link">å¹¶å‘ç¼–ç¨‹</a></li><li class="dropdown-item"><!----> <a href="/pages/e9d599/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/467393/" class="nav-link">æ–°ç‰¹æ€§</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸŒ´æ•°æ®åº“" class="dropdown-title"><a href="/pages/142be7/" class="link-title">ğŸŒ´æ•°æ®åº“</a> <span class="title" style="display:none;">ğŸŒ´æ•°æ®åº“</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/142be7/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/1ce2e2/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/62a615/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><a href="/pages/1b02d4/" class="nav-link">ğŸš€åç«¯æ¡†æ¶</a></div><div class="nav-item"><a href="/pages/1fe252/" class="nav-link">ğŸš€å‰ç«¯æŠ€æœ¯</a></div><div class="nav-item"><a href="/pages/83c955/" class="nav-link">ğŸ› ï¸å¼€å‘å·¥å…·</a></div> <a href="https://github.com/Aismy/aismy.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>node.js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/1fe252/" class="sidebar-link">ã€nodejsç®€ä»‹ã€‘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/1fe252/#node-jsæ˜¯ä»€ä¹ˆ" class="sidebar-link">Node.jsæ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li class="sidebar-sub-header level2"><a href="/pages/1fe252/#node-js-çš„åº”ç”¨" class="sidebar-link">Node.js çš„åº”ç”¨</a></li><li class="sidebar-sub-header level2"><a href="/pages/1fe252/#node-js-çš„ç‰¹ç‚¹" class="sidebar-link">Node.js çš„ç‰¹ç‚¹</a></li><li class="sidebar-sub-header level2"><a href="/pages/1fe252/#ä½¿ç”¨-node-js-æ—¶çš„åŠ£åŠ¿" class="sidebar-link">ä½¿ç”¨ Node.js æ—¶çš„åŠ£åŠ¿</a></li></ul></li><li><a href="/pages/ad57db/" class="sidebar-link">ã€nodejså¼€å‘ç¯å¢ƒå®‰è£…ã€‘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/ad57db/#ç‰ˆæœ¬ä»‹ç»" class="sidebar-link">ç‰ˆæœ¬ä»‹ç»</a></li><li class="sidebar-sub-header level2"><a href="/pages/ad57db/#node-js-è¿è¡Œç¯å¢ƒé…ç½®-é€šè¿‡-node-js-å®‰è£…åŒ…-ä¸æ¨è" class="sidebar-link">Node.js è¿è¡Œç¯å¢ƒé…ç½®ï¼šé€šè¿‡ Node.js å®‰è£…åŒ…ï¼ˆä¸æ¨èï¼‰</a></li><li class="sidebar-sub-header level2"><a href="/pages/ad57db/#node-js-è¿è¡Œç¯å¢ƒå®‰è£…-é€šè¿‡-nvm-æ¨è" class="sidebar-link">Node.js è¿è¡Œç¯å¢ƒå®‰è£…ï¼šé€šè¿‡ NVMï¼ˆæ¨èï¼‰</a></li><li class="sidebar-sub-header level2"><a href="/pages/ad57db/#nvm-çš„å¸¸ç”¨å‘½ä»¤" class="sidebar-link">NVM çš„å¸¸ç”¨å‘½ä»¤</a></li><li class="sidebar-sub-header level2"><a href="/pages/ad57db/#node-js-çš„å¸¸ç”¨å‘½ä»¤" class="sidebar-link">Node.js çš„å¸¸ç”¨å‘½ä»¤</a></li></ul></li><li><a href="/pages/1f0273/" class="sidebar-link">ã€npmçš„ä½¿ç”¨ã€‘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/1f0273/#åŒ…å’Œnpm" class="sidebar-link">åŒ…å’Œnpm</a></li><li class="sidebar-sub-header level2"><a href="/pages/1f0273/#npm-çš„å¸¸ç”¨å‘½ä»¤" class="sidebar-link">NPM çš„å¸¸ç”¨å‘½ä»¤</a></li><li class="sidebar-sub-header level2"><a href="/pages/1f0273/#é…ç½®-npm-é•œåƒæº" class="sidebar-link">é…ç½® npm é•œåƒæº</a></li><li class="sidebar-sub-header level2"><a href="/pages/1f0273/#ä»€ä¹ˆæ˜¯-npm-è„šæœ¬" class="sidebar-link">ä»€ä¹ˆæ˜¯ npm è„šæœ¬</a></li><li class="sidebar-sub-header level2"><a href="/pages/1f0273/#pnpm" class="sidebar-link">pnpm</a></li><li class="sidebar-sub-header level2"><a href="/pages/1f0273/#npmå‘½ä»¤æ€»ç»“" class="sidebar-link">npmå‘½ä»¤æ€»ç»“</a></li><li class="sidebar-sub-header level2"><a href="/pages/1f0273/#ä½¿ç”¨-nodemon-è‡ªåŠ¨é‡å¯æœåŠ¡" class="sidebar-link">ä½¿ç”¨ nodemon è‡ªåŠ¨é‡å¯æœåŠ¡</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>å‰ç«¯æŠ€æœ¯</span></li><li data-v-06225672><span data-v-06225672>node.js</span></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.aismy.top" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>Aismy</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-05-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">17 ã€æ–‡ä»¶ä¸Šä¼ ã€‘<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="_17-ã€æ–‡ä»¶ä¸Šä¼ ã€‘"><a href="#_17-ã€æ–‡ä»¶ä¸Šä¼ ã€‘" class="header-anchor">#</a> 17 ã€æ–‡ä»¶ä¸Šä¼ ã€‘</h1> <h2 id="_1-åˆå§‹åŒ–å‡†å¤‡"><a href="#_1-åˆå§‹åŒ–å‡†å¤‡" class="header-anchor">#</a> 1.åˆå§‹åŒ–å‡†å¤‡</h2> <h3 id="_1-1-å®‰è£…ä¾èµ–"><a href="#_1-1-å®‰è£…ä¾èµ–" class="header-anchor">#</a> 1.1 å®‰è£…ä¾èµ–</h3> <p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>express-multer-upload</code>å·¥ç¨‹é¡¹ç›®ï¼Œç„¶ååœ¨é¡¹ç›®ä¸­ä¸‹å¥½å„ç§ä¾èµ–åŒ…ã€‚</p> <p><strong>multerä¸­é—´ä»¶</strong></p> <p>Multer æ˜¯ä¸€ä¸ª node.js ä¸­é—´ä»¶ï¼Œç”¨äºå¤„ç† <code>multipart/form-data</code> ç±»å‹çš„è¡¨å•æ•°æ®ï¼Œå®ƒä¸»è¦ç”¨äºä¸Šä¼ æ–‡ä»¶ã€‚</p> <p><strong>æ³¨æ„</strong>: Multer ä¸ä¼šå¤„ç†ä»»ä½•é <code>multipart/form-data</code> ç±»å‹çš„è¡¨å•æ•°æ®ã€‚</p> <p>ä¸‹é¢æ˜¯æˆ‘ä¸‹è½½çš„ä¾èµ–ä»¥åŠç‰ˆæœ¬ã€‚</p> <p><img src="/assets/img/b61fccbd8e385d376270ad9ba3a8bf7e77a260e5.64b4a32a.png" alt="image-20221231143824464"></p> <h3 id="_1-2-é¡¹ç›®ç»“æ„åˆ’åˆ†"><a href="#_1-2-é¡¹ç›®ç»“æ„åˆ’åˆ†" class="header-anchor">#</a> 1.2  é¡¹ç›®ç»“æ„åˆ’åˆ†</h3> <p>æœ¬ç€ä»¥æ¯”è¾ƒè§„èŒƒçš„å½¢å¼å»å®Œæˆè¿™ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥æœ‰å¿…è¦è¿›è¡Œåˆç†çš„é¡¹ç›®ç»“æ„åˆ’åˆ†ã€‚å¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/fae1b84fb6e88e92b54428a9ba2fd93b0ad4680a.85f5067a.png" alt="image-20221231144220130"></p> <h2 id="_2-multerä¸Šä¼ é€»è¾‘"><a href="#_2-multerä¸Šä¼ é€»è¾‘" class="header-anchor">#</a> 2.multerä¸Šä¼ é€»è¾‘</h2> <h3 id="_2-1-multeré…ç½®"><a href="#_2-1-multeré…ç½®" class="header-anchor">#</a> 2.1 multeré…ç½®</h3> <p>åœ¨ multer ç›®å½•ä¸‹åˆ›å»º <strong>multerConfig.js</strong>ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p> <ul><li>å¼•å…¥ä¾èµ–</li> <li>å°è£…å¤„ç†è·¯å¾„å‡½æ•°</li> <li>è®¾ç½® multer çš„é…ç½®å¯¹è±¡</li> <li>ä¸º multer æ·»åŠ é…ç½®</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. å¼•å…¥ä¾èµ–</span>
<span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> 

<span class="token comment">// 2. å°è£…å¤„ç†è·¯å¾„å‡½æ•°</span>
<span class="token keyword">const</span> <span class="token function-variable function">handlePath</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./'</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. è®¾ç½® multer çš„é…ç½®å¯¹è±¡</span>
<span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 3.1 å­˜å‚¨è·¯å¾„</span>
  <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>mimetype <span class="token operator">===</span> <span class="token string">'image/jpeg'</span> <span class="token operator">||</span> file<span class="token punctuation">.</span>mimetype <span class="token operator">===</span> <span class="token string">'image/png'</span> <span class="token operator">||</span> file<span class="token punctuation">.</span>mimetype<span class="token operator">===</span><span class="token string">'image/gif'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">handlePath</span><span class="token punctuation">(</span><span class="token string">'../../public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'ä»…æ”¯æŒ jpg/png/gif æ ¼å¼çš„å›¾ç‰‡ï¼'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//  3.2 å­˜å‚¨åç§°</span>
  <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°†å›¾ç‰‡åç§°åˆ†å‰²ä¼ªæ•°ç»„ï¼Œç”¨äºæˆªå–å›¾ç‰‡çš„åç¼€</span>
    <span class="token keyword">const</span> fileFormat <span class="token operator">=</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    <span class="token comment">// è‡ªå®šä¹‰å›¾ç‰‡åç§°</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> fileFormat<span class="token punctuation">[</span>fileFormat<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 4. ä¸º multer æ·»åŠ é…ç½®</span>
<span class="token keyword">const</span> multerConfig <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span>
  <span class="token literal-property property">limits</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">2097152</span> <span class="token punctuation">}</span> <span class="token comment">// 2M</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> multerConfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>åœ¨è¯¥é…ç½®ä¸­å¯ä»¥è®¾ç½®æ–‡ä»¶ä¿å­˜çš„åœ°å€ã€æ–‡ä»¶åç§°ã€é™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼ã€æ–‡ä»¶å¤§å°</p> <h3 id="_2-2-uploadä¸Šä¼ é€»è¾‘"><a href="#_2-2-uploadä¸Šä¼ é€»è¾‘" class="header-anchor">#</a> 2.2 uploadä¸Šä¼ é€»è¾‘</h3> <p>åœ¨ multer ç›®å½•ä¸‹åˆ›å»º <strong>upload.js</strong>ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// å¼•å…¥é…ç½®å¥½çš„ multerConfig</span>
<span class="token keyword">const</span> multerConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./multerConfig'</span><span class="token punctuation">)</span>

<span class="token comment">// ä¸Šä¼ åˆ°æœåŠ¡å™¨åœ°å€</span>
<span class="token keyword">const</span> BaseURL <span class="token operator">=</span> <span class="token string">'http://localhost:3001'</span> 
<span class="token comment">// ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ç›®å½•</span>
<span class="token keyword">const</span> imgPath <span class="token operator">=</span> <span class="token string">'/public/'</span>

<span class="token comment">// å°è£…ä¸Šä¼ å›¾ç‰‡çš„æ¥å£</span>
<span class="token keyword">function</span> <span class="token function">uploadAvatar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    multerConfig<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¼ é€’çš„å›¾ç‰‡æ ¼å¼é”™è¯¯æˆ–è€…è¶…å‡ºæ–‡ä»¶é™åˆ¶å¤§å°ï¼Œå°±ä¼šrejectå‡ºå»</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‹¼æ¥æˆå®Œæ•´çš„æœåŠ¡å™¨é™æ€èµ„æºå›¾ç‰‡è·¯å¾„</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>BaseURL <span class="token operator">+</span> imgPath <span class="token operator">+</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> uploadAvatar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ä¸Šè¿°ä»£ç ä¸»è¦æ˜¯å°è£…äº†ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„æ–¹æ³•ï¼Œå½“å›¾ç‰‡ä¸Šä¼ æˆåŠŸæ—¶å°±å°†æ‹¼æ¥å¥½çš„å›¾ç‰‡é“¾æ¥ <code>resolve</code> å‡ºå»ã€‚è¯¥æ–¹æ³•ä¼šåœ¨æ§åˆ¶å™¨ä¸­è¢«è°ƒç”¨ã€‚</p> <p>æ³¨æ„ï¼šä¸Šé¢çš„ <code>multerConfig.single('file')</code> è¡¨ç¤ºå•æ–‡ä»¶ä¸Šä¼ ï¼Œå¹¶ä¸”å­—æ®µåä¸º &quot;file&quot;ï¼Œåé¢ä¸Šä¼ å›¾ç‰‡çš„å­—æ®µå¿…é¡»ä¿æŒä¸€è‡´</p> <h2 id="_3-ç¼–å†™æ§åˆ¶å™¨-å®šä¹‰è·¯ç”±"><a href="#_3-ç¼–å†™æ§åˆ¶å™¨-å®šä¹‰è·¯ç”±" class="header-anchor">#</a> 3.ç¼–å†™æ§åˆ¶å™¨ï¼Œå®šä¹‰è·¯ç”±</h2> <h3 id="_3-1-ç¼–å†™æ§åˆ¶å™¨"><a href="#_3-1-ç¼–å†™æ§åˆ¶å™¨" class="header-anchor">#</a> 3.1 ç¼–å†™æ§åˆ¶å™¨</h3> <p>åœ¨ controllers ç›®å½•ä¸‹åˆ›å»º <strong>UserController.js</strong>ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> uploadAvatar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../multer/upload'</span><span class="token punctuation">)</span>

<span class="token comment">// ç”¨æˆ·çš„é€»è¾‘æ§åˆ¶å™¨</span>
<span class="token keyword">const</span> UserController <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¤´åƒå›¾ç‰‡ä¸Šä¼ </span>
  <span class="token keyword">async</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> uploadRes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">uploadAvatar</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'ä¸Šä¼ æˆåŠŸï¼'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">img_url</span><span class="token operator">:</span> uploadRes<span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> UserController
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ä¸Šè¿°ä»£ç ä¸»è¦æ˜¯ç¼–å†™äº†ä¸€ä¸ªç”¨æˆ·æ§åˆ¶å™¨ç±» <code>UserController</code>ï¼Œä»¥åŠä¸€ä¸ªå›¾ç‰‡ä¸Šä¼ çš„æ–¹æ³• <code>upload</code>ã€‚</p> <p>åœ¨ <code>upload</code> ä¸­è°ƒç”¨äº†ä¸Šä¼ å›¾ç‰‡çš„æ¥å£ <code>uploadAvatar</code>ï¼Œå¾—åˆ°æˆåŠŸæˆ–å¤±è´¥çš„ç»“æœï¼Œåœ¨å“åº”ç»™å®¢æˆ·ç«¯ã€‚</p> <h3 id="_3-2-å®šä¹‰è·¯ç”±"><a href="#_3-2-å®šä¹‰è·¯ç”±" class="header-anchor">#</a> 3.2 å®šä¹‰è·¯ç”±</h3> <ol><li>åœ¨ routers ç›®å½•ä¸‹åˆ›å»º <strong>index.js</strong>ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// å¯¼å…¥ç”¨æˆ·é€»è¾‘</span>
<span class="token keyword">const</span> userController <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controllers/UserController'</span><span class="token punctuation">)</span>

<span class="token comment">// åˆ›å»ºè·¯ç”±å¯¹è±¡</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// è®¾ç½®è·¯ç”±</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload/avatar'</span><span class="token punctuation">,</span> userController<span class="token punctuation">.</span>upload<span class="token punctuation">)</span>

<span class="token comment">// å¯¼å…¥è·¯ç”±å¯¹è±¡</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="2"><li>å®šä¹‰äº†è·¯ç”±ä¹‹åè¿˜éœ€è¦åœ¨ <strong>app.js</strong> ä¸­æ³¨å†Œè·¯ç”±ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// å¯¼å…¥å®šä¹‰çš„è·¯ç”±</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/routers/index'</span><span class="token punctuation">)</span>

<span class="token comment">// æ³¨å†Œè·¯ç”±</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>åœ¨ app.js ä¸­ï¼Œå¢åŠ ä¸Šé¢ä¸¤è¡Œä»£ç å³å¯å®Œæˆè·¯ç”±æ³¨å†Œ</p> <h2 id="_4-ä¸Šä¼ å›¾ç‰‡"><a href="#_4-ä¸Šä¼ å›¾ç‰‡" class="header-anchor">#</a> 4.ä¸Šä¼ å›¾ç‰‡</h2> <p>æ¥ä¸‹æ¥è¿›å…¥æµ‹è¯•ç¯èŠ‚ï¼Œå€ŸåŠ© postman å·¥å…·è¿›è¡Œæµ‹è¯•</p> <p><img src="/assets/img/67de24fa073b3e001ef3b10e55a0d1ef2f359fe4.49674c9d.png" alt="image-20221231144808803"></p> <p>å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸçš„æ‹¿åˆ°äº†å“åº”çš„æ•°æ®ï¼Œé‡Œé¢ä¹ŸåŒ…å«äº†å›¾ç‰‡çš„é“¾æ¥åœ°å€</p> <p>æ³¨æ„ç‚¹ï¼š</p> <ul><li>è¡¨å•å¿…é¡»æ˜¯ form-data æ ¼å¼</li> <li>æ–‡ä»¶çš„å­—æ®µå¿…é¡»ä¸åç«¯ä¿æŒä¸€è‡´</li></ul> <h2 id="_5-å›¾ç‰‡åç§°ä¼˜åŒ–"><a href="#_5-å›¾ç‰‡åç§°ä¼˜åŒ–" class="header-anchor">#</a> 5.å›¾ç‰‡åç§°ä¼˜åŒ–</h2> <p>ç”±äºè¿™æ˜¯ä¸€ä¸ªç”¨æˆ·ä¸Šä¼ å¤´åƒå›¾ç‰‡çš„åŠŸèƒ½ï¼Œå½“ç”¨æˆ·ç¬¬äºŒæ¬¡ä¸Šä¼ å¤´åƒæ—¶ï¼Œéœ€è¦å°†åŸå…ˆçš„å›¾ç‰‡åˆ é™¤æ‰ï¼Œå¦åˆ™æ—§çš„å›¾ç‰‡ä¼šä¸€ç›´ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ã€‚</p> <p>ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ä½¿ç”¨ç”¨æˆ·idä½œä¸ºå›¾ç‰‡åç§°ï¼Œè¿™æ ·æ¯ä¸€æ¬¡ä¸Šä¼ å›¾ç‰‡ï¼Œéƒ½ä¼šæŠŠåŸæ¥çš„å›¾ç‰‡è¦†ç›–æ‰ã€‚ä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜</p> <ul><li>ä¸åŒæ ¼å¼çš„å›¾ç‰‡ä¼šæ®‹ç•™ï¼ˆjpgã€pngã€gifï¼‰ï¼Œä¸ä¼šè¢«è¦†ç›–æ‰</li> <li>å¦‚æœå¯ä»¥è¦†ç›–ï¼Œä½†æ˜¯å›¾ç‰‡é“¾æ¥åœ°å€ä¸ä¼šæœ‰å˜åŒ–ï¼Œå­˜å…¥æ•°æ®åº“æ—¶ä¹Ÿæ˜¯è·Ÿä¸Šä¸€æ¬¡çš„å›¾ç‰‡åœ°å€æ˜¯ç›¸åŒçš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´å‰ç«¯é¡µé¢ä¸ä¼šæ ¹æ®é™æ€èµ„æºä¸­å¤´åƒå›¾ç‰‡å˜åŒ–è€Œå˜åŒ–</li></ul> <p>æ‰€ä»¥è¿™é‡Œé‡‡ç”¨çš„åšæ³•æ˜¯å…ˆå¯¹å›¾ç‰‡çš„åç§°è¿›è¡Œæ‹¼æ¥ä¼˜åŒ–ï¼Œæ”¹ä¸ºå¦‚ä¸‹çš„å½¢å¼ï¼š</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>æ—¶é—´æˆ³.ç”¨æˆ·id.jpg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¿™æ ·æ—¢èƒ½ä¿è¯æ¯ä¸€å¼ å›¾ç‰‡éƒ½ä¸é‡å¤ï¼Œè€Œä¸”è¿˜é™„å¸¦äº†ç”¨æˆ·çš„id</p> <p>æ³¨ï¼šå¯ä»¥ä½¿ç”¨ md5 å¯¹æ—¶é—´æˆ³è¿›è¡ŒåŠ å¯†ï¼Œä»¥ç¡®ä¿å”¯ä¸€æ€§ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿å°±ç›´æ¥ä½¿ç”¨æ—¶é—´æˆ³ã€‚</p> <h2 id="_6-å›¾ç‰‡åç§°ä¼˜åŒ–å®ç°"><a href="#_6-å›¾ç‰‡åç§°ä¼˜åŒ–å®ç°" class="header-anchor">#</a> 6.å›¾ç‰‡åç§°ä¼˜åŒ–å®ç°</h2> <p>è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯åˆ é™¤æ—§å›¾ç‰‡ï¼Œé‡å‘½åæ–°å›¾ç‰‡ä¸ºè§„å®šçš„æ ¼å¼ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥å®ç°ã€‚</p> <h3 id="_6-1-å›¾ç‰‡å»é‡åˆ é™¤å’Œé‡å‘½å"><a href="#_6-1-å›¾ç‰‡å»é‡åˆ é™¤å’Œé‡å‘½å" class="header-anchor">#</a> 6.1 å›¾ç‰‡å»é‡åˆ é™¤å’Œé‡å‘½å</h3> <ul><li>æŸ¥æ‰¾æŒ‡å®šè·¯å¾„ä¸‹çš„æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶ï¼Œè¿›è¡Œéå†</li> <li>å…ˆæŸ¥è¯¢è¯¥idå‘½åçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™åˆ é™¤</li> <li>æ ¹æ®æ–°å­˜å…¥çš„æ–‡ä»¶å(æ—¶é—´æˆ³.jpg)ï¼Œæ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼Œç„¶åé‡å‘½åä¸º: <code>æ—¶é—´æˆ³.id.jpg</code></li></ul> <p>åœ¨<strong>upload.js</strong>ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">// å¯¹å›¾ç‰‡è¿›è¡Œå»é‡åˆ é™¤å’Œé‡å‘½å</span>
<span class="token keyword">const</span> <span class="token function-variable function">hanldeImgDelAndRename</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> dirPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO æŸ¥æ‰¾è¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶</span>
  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å½“å‰å›¾ç‰‡çš„åç§°</span>
      <span class="token keyword">const</span> currentImgName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// å›¾ç‰‡çš„åç§°æ•°ç»„ï¼š[æ—¶é—´æˆ³, id, åç¼€]</span>
      <span class="token keyword">const</span> imgNameArr <span class="token operator">=</span> currentImgName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>

      <span class="token comment">// TODO å…ˆæŸ¥è¯¢è¯¥idå‘½åçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæœ‰åˆ™åˆ é™¤</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>imgNameArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentImgPath <span class="token operator">=</span> dirPath <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> currentImgName
        fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>currentImgPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// TODO æ ¹æ®æ–°å­˜å…¥çš„æ–‡ä»¶å(æ—¶é—´æˆ³.jpg)ï¼Œæ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼Œç„¶åé‡å‘½åä¸º: æ—¶é—´æˆ³.id.jpg</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentImgName <span class="token operator">===</span> filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> old_path <span class="token operator">=</span> dirPath <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> currentImgName
        <span class="token keyword">const</span> new_path <span class="token operator">=</span> dirPath <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> imgNameArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> id  <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">// é‡å‘½åè¯¥æ–‡ä»¶</span>
        fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> new_path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>å‡½æ•°æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š</p> <ol><li>è¯¥å‡½æ•°ä¸»è¦è°ƒç”¨äº† <code>fs</code> å†…ç½®æ¨¡å—ä¸­çš„ <code>readdir</code> è¿›è¡ŒæŒ‡å®šè·¯å¾„æŸ¥è¯¢æ–‡ä»¶ï¼Œå†è¿›è¡Œéå†</li> <li>å°†å›¾ç‰‡åç§°åˆ†å‰²ä¸ºæ•°ç»„ï¼Œå–å‡ºidä¸ä¼ å…¥çš„idè¿›è¡Œåˆ¤æ–­ï¼Œç¬¦åˆæ¡ä»¶åˆ™è°ƒç”¨ <code>fs</code> å†…ç½®æ¨¡å—ä¸­çš„ <code>fs.unlink()</code> æ–¹æ³•åˆ é™¤æ–‡ä»¶</li> <li>æ ¹æ®æ–°å­˜å…¥çš„æ–‡ä»¶å(æ—¶é—´æˆ³.jpg)ï¼Œæ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼Œç„¶åé‡å‘½åä¸º: <code>æ—¶é—´æˆ³.id.jpg</code>ã€‚ç„¶åè°ƒç”¨ <code>fs</code> å†…ç½®æ¨¡å—ä¸­çš„ <code>fs.rename()</code> æ–¹æ³•é‡å‘½åæ–‡ä»¶</li></ol> <h3 id="_6-2-ä¿®æ”¹-uploadavatar-æ¥å£"><a href="#_6-2-ä¿®æ”¹-uploadavatar-æ¥å£" class="header-anchor">#</a> 6.2 ä¿®æ”¹ uploadAvatar æ¥å£</h3> <p>å®Œæˆå›¾ç‰‡å»é‡åˆ é™¤å’Œé‡å‘½å <code>hanldeImgDelAndRename</code> æ–¹æ³•åï¼Œè¿˜éœ€è¦åœ¨ <strong>upload.js</strong> ä¸­åŸå…ˆçš„ä¸Šä¼ æ¥å£æ–¹æ³• <code>uploadAvatar</code> ä¸­è¿›è¡Œè°ƒç”¨ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç ï¼š</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// å°è£…å¤„ç†è·¯å¾„å‡½æ•°</span>
<span class="token keyword">const</span> <span class="token function-variable function">handlePath</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./'</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¸Šä¼ æ¥å£çš„ è¯·æ±‚å‚æ•°req  å“åº”å‚æ•°res</span>
<span class="token keyword">function</span> <span class="token function">uploadAvatar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    multerConfig<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯¹å›¾ç‰‡è¿›è¡Œå»é‡åˆ é™¤å’Œé‡å‘½å</span>
        <span class="token function">hanldeImgDelAndRename</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">,</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token function">handlePath</span><span class="token punctuation">(</span><span class="token string">'../../public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> img <span class="token operator">=</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          <span class="token comment">// é‡æ–°è¿”å›ç¬¦åˆè§„å®šçš„å›¾ç‰‡é“¾æ¥åœ°å€</span>
          <span class="token literal-property property">img_url</span><span class="token operator">:</span> BaseURL <span class="token operator">+</span> imgPath <span class="token operator">+</span> img<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> img<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>æ³¨æ„ï¼šåœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¿…é¡»æºå¸¦ id å­—æ®µï¼Œè¿™æ · <code>req.body.id</code> æ‰èƒ½è·å–åˆ°ä¼ å…¥çš„ idã€‚</p> <h2 id="_7-æœ€ç»ˆæµ‹è¯•"><a href="#_7-æœ€ç»ˆæµ‹è¯•" class="header-anchor">#</a> 7.æœ€ç»ˆæµ‹è¯•</h2> <h3 id="_7-1-ç¬¬ä¸€æ¬¡ä¸Šä¼ "><a href="#_7-1-ç¬¬ä¸€æ¬¡ä¸Šä¼ " class="header-anchor">#</a> 7.1 ç¬¬ä¸€æ¬¡ä¸Šä¼ </h3> <p><img src="/assets/img/091fb78bd9060b86acfb97692aac08896e7145cf.bb183fd8.png" alt="image-20221231145520966"></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œå›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼Œå¹¶ä¸”å›¾ç‰‡çš„åç§°ä¹Ÿæ˜¯æŒ‰ç…§æˆ‘ä»¬çš„è§„å®šè¿›è¡Œæ‹¼æ¥ï¼Œåç«¯æœåŠ¡å™¨ä¹ŸæˆåŠŸä¿å­˜äº†ä¸Šä¼ çš„å›¾ç‰‡ã€‚</p> <p><img src="/assets/img/c9b36c3e07689163cdf719f27613600efc655764.f4179c67.png" alt="image-20221231145533537"></p> <h3 id="_7-2-ç¬¬äºŒæ¬¡ä¸Šä¼ "><a href="#_7-2-ç¬¬äºŒæ¬¡ä¸Šä¼ " class="header-anchor">#</a> 7.2 ç¬¬äºŒæ¬¡ä¸Šä¼ </h3> <p><img src="/assets/img/f8cc5e1e10251493e090ee2030861d3d279c7bed.adb4245c.png" alt="image-20221231145555139"></p> <p>ç¬¬äºŒæ¬¡ä¸Šä¼ ï¼ŒæˆåŠŸçš„å°†ç›¸åŒ id çš„æ—§å›¾ç‰‡è¿›è¡Œäº†åˆ é™¤ï¼Œå¹¶ä¸”é‡å‘½åäº†å›¾ç‰‡åç§°ã€‚</p> <h3 id="_7-3-ç¬¬ä¸‰æ¬¡ä¸Šä¼ "><a href="#_7-3-ç¬¬ä¸‰æ¬¡ä¸Šä¼ " class="header-anchor">#</a> 7.3 ç¬¬ä¸‰æ¬¡ä¸Šä¼ </h3> <p>è¿™é‡Œè¿˜å¯ä»¥ä¸Šä¼ ä¸åŒ id ä»¥è¡¨ç¤ºä¸åŒç”¨æˆ·ä¸Šä¼ å¤´åƒæ¥è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/7fcff0c72d96af7a77e65901326d43e211c58635.b1f7c87e.png" alt="image-20221231145616872"></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒ id ä¹‹é—´ä¸Šä¼ çš„å›¾ç‰‡æ˜¯äº’ä¸å¹²æ‰°çš„ï¼Œåªæœ‰å½“ id åŒ¹é…æ—¶æ‰ä¼šè¿›è¡Œæ›¿æ¢å’Œé‡å‘½åã€‚</p> <p>æœ€ååªéœ€è¦åœ¨æ§åˆ¶å™¨å½“ä¸­ï¼ŒæŠŠè·å–åˆ°çš„å›¾ç‰‡é“¾æ¥åœ°å€ä¿å­˜åˆ°æ•°æ®åº“å³å¯ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®ç”¨æˆ· id è¿›è¡Œä¿å­˜ã€‚</p> <h2 id="_8-ajaxä¸Šä¼ "><a href="#_8-ajaxä¸Šä¼ " class="header-anchor">#</a> 8.ajaxä¸Šä¼ </h2> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ajax<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>ajaxä¸Šä¼ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ä¸Šä¼ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ajax [type=button]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> username <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ajax [name=username]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> password <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ajax [name=password]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> avatar <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ajax [name=avatar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  avatar<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºé¢„è§ˆåœ°å€</span>
    <span class="token keyword">let</span> httpUrl <span class="token operator">=</span> window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>avatar<span class="token punctuation">.</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> httpUrl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¦å¤„ç†æˆè¡¨å•å¯¹è±¡ä¸Šä¼ </span>
    <span class="token keyword">const</span> formsdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    formsdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> username<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    formsdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span> password<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿½åŠ nameå€¼ï¼Œå’Œæ–‡ä»¶å¯¹è±¡</span>
    formsdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">,</span> avatar<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    axios
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/upload/avatar'</span><span class="token punctuation">,</span> formsdata<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>imgPath<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Aismy/aismy.github.io/edit/master/docs/05.å‰ç«¯æŠ€æœ¯/01.node.js/17 ã€æ–‡ä»¶ä¸Šä¼ ã€‘.md" target="_blank" rel="noopener noreferrer">åœ¨çº¿ç¼–è¾‘æ­¤æ–‡ç« </a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><!----> <!----></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:752704491@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Aismy" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2023
    <span>Aismy | MIT License</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b738e2cf.js" defer></script><script src="/assets/js/2.ffb45a81.js" defer></script><script src="/assets/js/5.58eac4fd.js" defer></script>
  </body>
</html>
