<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringCloud | Aismy&#39;Docs</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Aismy&#39;Docs">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.906cd319.css" as="style"><link rel="preload" href="/assets/js/app.b738e2cf.js" as="script"><link rel="preload" href="/assets/js/2.ffb45a81.js" as="script"><link rel="preload" href="/assets/js/29.aa305b1a.js" as="script"><link rel="prefetch" href="/assets/js/10.c2e0087a.js"><link rel="prefetch" href="/assets/js/11.515afe89.js"><link rel="prefetch" href="/assets/js/12.fab2a176.js"><link rel="prefetch" href="/assets/js/13.001935e7.js"><link rel="prefetch" href="/assets/js/14.b80dbf2e.js"><link rel="prefetch" href="/assets/js/15.1b1059f6.js"><link rel="prefetch" href="/assets/js/16.fcd1537c.js"><link rel="prefetch" href="/assets/js/17.9df6cc33.js"><link rel="prefetch" href="/assets/js/18.bd3b4e60.js"><link rel="prefetch" href="/assets/js/19.c0b3ce9a.js"><link rel="prefetch" href="/assets/js/20.546547fb.js"><link rel="prefetch" href="/assets/js/21.0692e109.js"><link rel="prefetch" href="/assets/js/22.941054f1.js"><link rel="prefetch" href="/assets/js/23.6a79feac.js"><link rel="prefetch" href="/assets/js/24.d7b40265.js"><link rel="prefetch" href="/assets/js/25.2f068444.js"><link rel="prefetch" href="/assets/js/26.39e773a6.js"><link rel="prefetch" href="/assets/js/27.0cc11d71.js"><link rel="prefetch" href="/assets/js/28.6e0bab80.js"><link rel="prefetch" href="/assets/js/3.166f9e48.js"><link rel="prefetch" href="/assets/js/30.a9437cbd.js"><link rel="prefetch" href="/assets/js/31.d2300f1b.js"><link rel="prefetch" href="/assets/js/32.30060633.js"><link rel="prefetch" href="/assets/js/33.ddd9f9e8.js"><link rel="prefetch" href="/assets/js/34.102c62c1.js"><link rel="prefetch" href="/assets/js/35.da833d69.js"><link rel="prefetch" href="/assets/js/36.b4b83ef9.js"><link rel="prefetch" href="/assets/js/37.a549e9e3.js"><link rel="prefetch" href="/assets/js/38.e84bf93e.js"><link rel="prefetch" href="/assets/js/39.145b375f.js"><link rel="prefetch" href="/assets/js/4.2988106a.js"><link rel="prefetch" href="/assets/js/40.246cd152.js"><link rel="prefetch" href="/assets/js/41.530026b3.js"><link rel="prefetch" href="/assets/js/42.24a60b39.js"><link rel="prefetch" href="/assets/js/43.902a7b0b.js"><link rel="prefetch" href="/assets/js/44.4f8c78f2.js"><link rel="prefetch" href="/assets/js/5.58eac4fd.js"><link rel="prefetch" href="/assets/js/6.d50e78bb.js"><link rel="prefetch" href="/assets/js/7.977fe42a.js"><link rel="prefetch" href="/assets/js/8.289b9caf.js"><link rel="prefetch" href="/assets/js/9.6a3fba9d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.906cd319.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Aismy'Docs" class="logo"> <span class="site-name can-hide">Aismy'Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://www.aismy.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📕博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🍵Java SE" class="dropdown-title"><a href="/pages/389d93/" class="link-title">🍵Java SE</a> <span class="title" style="display:none;">🍵Java SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/389d93/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/aab896/" class="nav-link">集合</a></li><li class="dropdown-item"><!----> <a href="/pages/d2a30d/" class="nav-link">IO流</a></li><li class="dropdown-item"><!----> <a href="/pages/780f7d/" class="nav-link">注解和反射</a></li><li class="dropdown-item"><!----> <a href="/pages/8d2bfc/" class="nav-link">并发编程</a></li><li class="dropdown-item"><!----> <a href="/pages/e9d599/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/467393/" class="nav-link">新特性</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌴数据库" class="dropdown-title"><a href="/pages/142be7/" class="link-title">🌴数据库</a> <span class="title" style="display:none;">🌴数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/142be7/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/1ce2e2/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/62a615/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><a href="/pages/1b02d4/" class="nav-link">🚀后端框架</a></div><div class="nav-item"><a href="/pages/1fe252/" class="nav-link">🚀前端技术</a></div><div class="nav-item"><a href="/pages/83c955/" class="nav-link">🛠️开发工具</a></div> <a href="https://github.com/Aismy/aismy.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://www.aismy.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📕博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🍵Java SE" class="dropdown-title"><a href="/pages/389d93/" class="link-title">🍵Java SE</a> <span class="title" style="display:none;">🍵Java SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/389d93/" class="nav-link">Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/aab896/" class="nav-link">集合</a></li><li class="dropdown-item"><!----> <a href="/pages/d2a30d/" class="nav-link">IO流</a></li><li class="dropdown-item"><!----> <a href="/pages/780f7d/" class="nav-link">注解和反射</a></li><li class="dropdown-item"><!----> <a href="/pages/8d2bfc/" class="nav-link">并发编程</a></li><li class="dropdown-item"><!----> <a href="/pages/e9d599/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/467393/" class="nav-link">新特性</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🌴数据库" class="dropdown-title"><a href="/pages/142be7/" class="link-title">🌴数据库</a> <span class="title" style="display:none;">🌴数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/142be7/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/pages/1ce2e2/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/62a615/" class="nav-link">ElasticSearch</a></li></ul></div></div><div class="nav-item"><a href="/pages/1b02d4/" class="nav-link">🚀后端框架</a></div><div class="nav-item"><a href="/pages/1fe252/" class="nav-link">🚀前端技术</a></div><div class="nav-item"><a href="/pages/83c955/" class="nav-link">🛠️开发工具</a></div> <a href="https://github.com/Aismy/aismy.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/36a6df/" aria-current="page" class="active sidebar-link">SpringCloud</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#springcloud和springboot版本对应关系" class="sidebar-link">SpringCloud和SpringBoot版本对应关系</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#相关组件" class="sidebar-link">相关组件</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#resttemplate" class="sidebar-link">RestTemplate</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#eureka基础知识" class="sidebar-link">Eureka基础知识</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#单机eureka构建步骤" class="sidebar-link">单机Eureka构建步骤</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#eureka集群搭建" class="sidebar-link">Eureka集群搭建</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#服务提供者集群搭建" class="sidebar-link">服务提供者集群搭建</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#服务发现discovery" class="sidebar-link">服务发现Discovery</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#eureka自我保护" class="sidebar-link">Eureka自我保护</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#注册中心异同点" class="sidebar-link">注册中心异同点</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#cap理论" class="sidebar-link">CAP理论</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#服务调用几种方式" class="sidebar-link">服务调用几种方式</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#二、ribbon-resttemplate" class="sidebar-link">二、Ribbon+RestTemplate</a></li><li class="sidebar-sub-header level2"><a href="/pages/36a6df/#loadbalancer和ribbon" class="sidebar-link">loadbalancer和Ribbon</a></li></ul></li><li><a href="/pages/8c1c55/" class="sidebar-link">SpringCloudAlibaba</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-0-学习目标" class="sidebar-link">1.0.学习目标</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-1-单体架构" class="sidebar-link">1.1.单体架构</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-2-分布式架构" class="sidebar-link">1.2.分布式架构</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-3-微服务" class="sidebar-link">1.3.微服务</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-4-springcloud" class="sidebar-link">1.4.SpringCloud</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-5-总结" class="sidebar-link">1.5.总结</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-1-服务拆分原则" class="sidebar-link">2.1.服务拆分原则</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-2-服务拆分示例" class="sidebar-link">2.2.服务拆分示例</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-3-实现远程调用案例" class="sidebar-link">2.3.实现远程调用案例</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-4-提供者与消费者" class="sidebar-link">2.4.提供者与消费者</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-1-eureka的结构和作用" class="sidebar-link">3.1.Eureka的结构和作用</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-2-搭建eureka-server" class="sidebar-link">3.2.搭建eureka-server</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-3-服务注册" class="sidebar-link">3.3.服务注册</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-4-服务发现" class="sidebar-link">3.4.服务发现</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_4-1-负载均衡原理" class="sidebar-link">4.1.负载均衡原理</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_4-2-源码跟踪" class="sidebar-link">4.2.源码跟踪</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_4-3-负载均衡策略" class="sidebar-link">4.3.负载均衡策略</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_4-4-饥饿加载" class="sidebar-link">4.4.饥饿加载</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_5-1-认识和安装nacos" class="sidebar-link">5.1.认识和安装Nacos</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_5-2-服务注册到nacos" class="sidebar-link">5.2.服务注册到nacos</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_5-3-服务分级存储模型" class="sidebar-link">5.3.服务分级存储模型</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_5-4-权重配置" class="sidebar-link">5.4.权重配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_5-5-环境隔离" class="sidebar-link">5.5.环境隔离</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_5-6-nacos与eureka的区别" class="sidebar-link">5.6.Nacos与Eureka的区别</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-1-统一配置管理" class="sidebar-link">1.1.统一配置管理</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-2-配置热更新" class="sidebar-link">1.2.配置热更新</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-3-配置共享" class="sidebar-link">1.3.配置共享</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_1-4-搭建nacos集群" class="sidebar-link">1.4.搭建Nacos集群</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-1-feign替代resttemplate" class="sidebar-link">2.1.Feign替代RestTemplate</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-2-自定义配置" class="sidebar-link">2.2.自定义配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-3-feign使用优化" class="sidebar-link">2.3.Feign使用优化</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_2-4-最佳实践" class="sidebar-link">2.4.最佳实践</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-1-为什么需要网关" class="sidebar-link">3.1.为什么需要网关</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-2-gateway快速入门" class="sidebar-link">3.2.gateway快速入门</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-3-断言工厂" class="sidebar-link">3.3.断言工厂</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-4-过滤器工厂" class="sidebar-link">3.4.过滤器工厂</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-5-全局过滤器" class="sidebar-link">3.5.全局过滤器</a></li><li class="sidebar-sub-header level2"><a href="/pages/8c1c55/#_3-6-跨域问题" class="sidebar-link">3.6.跨域问题</a></li></ul></li><li><a href="/pages/5e0b47/" class="sidebar-link">Nacos安装指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_1-1-下载安装包" class="sidebar-link">1.1.下载安装包</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_1-2-解压" class="sidebar-link">1.2.解压</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_1-3-端口配置" class="sidebar-link">1.3.端口配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_1-4-启动" class="sidebar-link">1.4.启动</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_1-5-访问" class="sidebar-link">1.5.访问</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_2-1-安装jdk" class="sidebar-link">2.1.安装JDK</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_2-2-上传安装包" class="sidebar-link">2.2.上传安装包</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_2-3-解压" class="sidebar-link">2.3.解压</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_2-4-端口配置" class="sidebar-link">2.4.端口配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e0b47/#_2-5-启动" class="sidebar-link">2.5.启动</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>持久层框架</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>开发框架</span></li><li data-v-06225672><span data-v-06225672>SpringCloud</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.aismy.top" target="_blank" title="作者" class="beLink" data-v-06225672>Aismy</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">SpringCloud<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="一、springcloud入门"><a href="#一、springcloud入门" class="header-anchor">#</a> 一、springcloud入门</h1> <h2 id="springcloud和springboot版本对应关系"><a href="#springcloud和springboot版本对应关系" class="header-anchor">#</a> SpringCloud和SpringBoot版本对应关系</h2> <p><img src="http://img.aismy.top/img/image-20220619103847527.png" alt="image-20220619103847527"></p> <p>更详细的版本对应查看方法：https://start.spring.io/actuator/info</p> <h2 id="相关组件"><a href="#相关组件" class="header-anchor">#</a> 相关组件</h2> <img src="http://img.aismy.top/img/image-20220619103802059.png" alt="image-20220619103802059"> <h2 id="resttemplate"><a href="#resttemplate" class="header-anchor">#</a> RestTemplate</h2> <p>RestTemplate提供了多种便捷访问远程Http服务的方法， 是一种简单便捷的访问restful服务模板类，是<code>Spring</code>提供的用于访问Rest服务的<code>客户端模板工具集</code></p> <p><strong>官网地址</strong>
https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</p> <p><strong>使用</strong>
使用restTemplate访问restful接口非常的简单粗暴无脑。(url, requestMap, ResponseBean.class)这三个参数分别代表
REST请求地址、请求参数、HTTP响应转换被转换成的对象类型。</p> <p>要想使用RestTemplate调用其他服务，则需先将RestTemplate交给spring容器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>调用示例: 在order模块中调用payment模块中的服务</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">PaymentSrv_URL</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8001&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/payment/create&quot;</span><span class="token punctuation">)</span> <span class="token comment">//客户端用浏览器是get请求，但是底层实质发送post调用服务端8001</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForObject</span><span class="token punctuation">(</span><span class="token class-name">PaymentSrv_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/payment/create&quot;</span><span class="token punctuation">,</span>payment<span class="token punctuation">,</span><span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/consumer/payment/get/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token class-name">PaymentSrv_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/payment/get/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h1 id="二、eureka服务注册与发现"><a href="#二、eureka服务注册与发现" class="header-anchor">#</a> 二、Eureka服务注册与发现</h1> <h2 id="eureka基础知识"><a href="#eureka基础知识" class="header-anchor">#</a> Eureka基础知识</h2> <h3 id="什么是服务治理"><a href="#什么是服务治理" class="header-anchor">#</a> 什么是服务治理？</h3> <blockquote><p>Spring Cloud 封装了 Netflix 公司开发的 Eureka 模块来实现服务治理，在传统的rpc远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理比较复杂，所以需要使用服务治理，管理服务于服务之间依赖关系，可以实现服务调用、负载均衡、容错等，实现服务发现与注册。</p></blockquote> <p>在上面示例中使用RestTemplate也可以调用服务，为什么还需要Eureka呢</p> <blockquote><p>当消费者和生产者变多的时候，若没有统一管理各个服务，则服务调用会变得越来越繁琐，而Eureka可以为我们进行服务的治理</p></blockquote> <h3 id="什么是服务注册与发现"><a href="#什么是服务注册与发现" class="header-anchor">#</a> 什么是服务注册与发现？</h3> <blockquote><p>Eureka采用了CS的设计架构，Eureka Server 作为服务注册功能的服务器，它是服务注册中心。而系统中的其他微服务，使用 Eureka的客户端连接到 Eureka Server并维持心跳连接。这样系统的维护人员就可以通过 Eureka Server 来监控系统中各个微服务是否正常运行。
在服务注册与发现中，有一个注册中心。当服务器启动的时候，会把当前自己服务器的信息 比如 服务地址通讯地址等以别名方式注册到注册中心上。另一方（消费者|服务提供者），以该别名的方式去注册中心上获取到实际的服务通讯地址，然后再实现本地RPC调用RPC远程调用框架核心设计思想：在于注册中心，因为使用注册中心管理每个服务与服务之间的一个依赖关系(服务治理概念)。在任何rpc远程框架中，都会有一个注册中心(存放服务地址相关信息(接口地址))</p></blockquote> <p>下左图是Eureka系统架构，右图是Dubbo的架构，请对比</p> <p><img src="http://img.aismy.top/img/image-20220619105300665.png" alt="image-20220619105300665"></p> <p>为了避免单点故障，在实际开发中，生产者和Eureka Server 往往都是集群，</p> <h3 id="eureka两个组件"><a href="#eureka两个组件" class="header-anchor">#</a> Eureka两个组件</h3> <p>Eureka包含两个组件：<code>Eureka Server</code>和<code>Eureka Client</code></p> <p><strong>Eureka Server提供服务注册服务</strong>
各个微服务节点通过配置启动后，会在EurekaServer中进行注册，这样EurekaServer中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观看到。</p> <p><strong>EurekaClient通过注册中心进行访问</strong>
是一个Java客户端，用于简化Eureka Server的交互，客户端同时也具备一个内置的、使用轮询(round-robin)负载算法的负载均衡器。在应用启动后，将会向Eureka Server发送心跳(默认周期为30秒)。如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，EurekaServer将会从服务注册表中把这个服务节点移除（默认90秒）</p> <h2 id="单机eureka构建步骤"><a href="#单机eureka构建步骤" class="header-anchor">#</a> 单机Eureka构建步骤</h2> <h3 id="eurekaserver端服务注册中心"><a href="#eurekaserver端服务注册中心" class="header-anchor">#</a> eurekaServer端服务注册中心</h3> <p><strong>添加pom文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>以前的老版本（当前使用2018）
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-eureka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
 
现在新版本（当前使用2020.2）
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在老版本中server和client都混合在一个依赖中，而目前新版本将server和client分开，清晰明了，推进使用新版本依赖</p> <p><strong>添加yml</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7001</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment">#eureka服务端的实例名称</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token comment">#false表示不向注册中心注册自己。</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token comment">#false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
    <span class="token comment">#设置与Eureka Server交互的地址查询服务和注册服务都需要依赖这个地址。</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>eureka.instance.hostname<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/eureka/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>启动类添加@EnableEurekaServer注解</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaMain7001</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EurekaMain7001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>**测试：**浏览器输入http://localhost:7001/</p> <p><img src="http://img.aismy.top/img/image-20220619110138584.png" alt="image-20220619110138584"></p> <p>可见当前还为有服务注册进来</p> <h3 id="eurekaclient端"><a href="#eurekaclient端" class="header-anchor">#</a> EurekaClient端</h3> <p>将其他服务注册到EurekaServe中</p> <p><strong>添加pom</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>以前老版本，别再使用
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-eureka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
现在新版本,当前使用
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>添加yml</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token comment">#表示是否将自己注册进EurekaServer默认为true。</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span>
    <span class="token key atrule">fetchRegistry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>启动类添加@EnableEurekaClient注解</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain8001</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">PaymentMain8001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>测试：启动该服务，进去注册中心查看</strong></p> <p><img src="http://img.aismy.top/img/image-20220619110713329.png" alt="image-20220619110713329"></p> <h2 id="eureka集群搭建"><a href="#eureka集群搭建" class="header-anchor">#</a> Eureka集群搭建</h2> <h3 id="eureka集群原理说明"><a href="#eureka集群原理说明" class="header-anchor">#</a> Eureka集群原理说明</h3> <p><img src="http://img.aismy.top/img/image-20220619120609244.png" alt="image-20220619120609244"></p> <p><img src="http://img.aismy.top/img/image-20220619120721027.png" alt="image-20220619120721027"></p> <p>修改映射配置添加进hosts文件 ：模拟两台主机</p> <p><img src="http://img.aismy.top/img/image-20220619120819385.png" alt="image-20220619120819385"></p> <h3 id="eurekaserver集群搭建"><a href="#eurekaserver集群搭建" class="header-anchor">#</a> EurekaServer集群搭建</h3> <p><strong>修改EurekaServer的yml文件</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7001</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka7001.com <span class="token comment">#eureka服务端的实例名称</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>     <span class="token comment">#false表示不向注册中心注册自己。</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>     <span class="token comment">#false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7002.com<span class="token punctuation">:</span>7002/eureka/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7002</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka7002.com <span class="token comment">#eureka服务端的实例名称</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>     <span class="token comment">#false表示不向注册中心注册自己。</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>     <span class="token comment">#false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>互相注册，互相守望</p> <h3 id="将eurekaclient注册到eurekaserver集群中"><a href="#将eurekaclient注册到eurekaserver集群中" class="header-anchor">#</a> 将EurekaClient注册到EurekaServer集群中</h3> <p>修改EurekaClient的yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token comment">#表示是否将自己注册进EurekaServer默认为true。</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span>
    <span class="token key atrule">fetchRegistry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment">#defaultZone: http://localhost:7001/eureka 单机版</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka7002.com<span class="token punctuation">:</span>7002/eureka  <span class="token comment"># 集群版</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>测试：</p> <p>访问http://eureka7001.com:7001/</p> <p><img src="http://img.aismy.top/img/image-20220619121531488.png" alt="image-20220619121531488"></p> <p>访问http://eureka7002.com:7002/</p> <p><img src="http://img.aismy.top/img/image-20220619121601206.png" alt="image-20220619121601206"></p> <blockquote><p>EurekaServer之间互相注册，互相守望，EurekaServer集群中都存在EurekaClient</p></blockquote> <h2 id="服务提供者集群搭建"><a href="#服务提供者集群搭建" class="header-anchor">#</a> 服务提供者集群搭建</h2> <p>修改cloud-provider-payment参数，模拟集群</p> <p><img src="http://img.aismy.top/img/image-20220619125431158.png" alt="image-20220619125431158"></p> <p>两个服务都被注册到注册中心中</p> <p><img src="http://img.aismy.top/img/image-20220619125507167.png" alt="image-20220619125507167"></p> <p>测试消费者cloud-consumer-order模块</p> <p><img src="http://img.aismy.top/img/image-20220619130344885.png" alt="image-20220619130344885"></p> <p>发现只能调用8001端口的服务</p> <p>原controller代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYMENT_URL</span><span class="token operator">=</span><span class="token string">&quot;http://localhost:8001&quot;</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span> <span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Payment</span> payment<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForObject</span><span class="token punctuation">(</span><span class="token constant">PAYMENT_URL</span><span class="token operator">+</span><span class="token string">&quot;payment/create&quot;</span><span class="token punctuation">,</span>payment<span class="token punctuation">,</span><span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;get/{id}&quot;</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token constant">PAYMENT_URL</span><span class="token operator">+</span><span class="token string">&quot;payment/get/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">,</span><span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>现在服务提供者为集群，则不能使用固定的ip加端口号去调用，应该使用<code>服务名称</code>去调用</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 通过在eureka上注册过的微服务名称调用</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PAYMENT_SRV</span> <span class="token operator">=</span> <span class="token string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>修改后测试：</strong></p> <p><img src="http://img.aismy.top/img/image-20220619130759750.png" alt="image-20220619130759750"></p> <blockquote><p>修改为使用服务名称调用后，发现调用失败，原因是：因为此时服务提供者为集群搭建，同一个服务名称下有多个服务实例，此时不知道调用哪一个服务实例，因此抛出异常</p></blockquote> <p><strong>解决方法：使用@LoadBalanced注解赋予RestTemplate负载均衡的能力</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment">//使用@LoadBalanced注解赋予RestTemplate负载均衡的能力</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>测试：http://localhost/consumer/payment/get/1</p> <p><img src="http://img.aismy.top/img/image-20220619155948860.png" alt="image-20220619155948860"></p> <p>再次访问：http://localhost/consumer/payment/get/1</p> <p><img src="http://img.aismy.top/img/image-20220619160001968.png" alt="image-20220619160001968"></p> <blockquote><p>两次访问，调用了不同端口的payment服务，负载均衡效果实现(默认为<code>轮询</code>调用)</p></blockquote> <h2 id="服务发现discovery"><a href="#服务发现discovery" class="header-anchor">#</a> 服务发现Discovery</h2> <blockquote><p>对于注册进<code>eureka</code>里面的微服务，可以通过服务发现来获得该服务的信息</p></blockquote> <p>修改cloud-provider-payment8001的Controller</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;discovery&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">discovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> services <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ServiceInstance</span> element <span class="token operator">:</span> instances<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> element<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> element<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span>
                    <span class="token operator">+</span> element<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>discoveryClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>添加启动类注解：@EnableDiscoveryClient</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Payment8001</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Payment8001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>测试：访问http://localhost:8001/payment/discovery</p> <p><img src="http://img.aismy.top/img/image-20220619163156613.png" alt="image-20220619163156613"></p> <p>控制台：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>cloud<span class="token operator">-</span>consumer<span class="token operator">-</span>order
cloud<span class="token operator">-</span>payment<span class="token operator">-</span>service
<span class="token constant">CLOUD</span><span class="token operator">-</span><span class="token constant">PAYMENT</span><span class="token operator">-</span><span class="token constant">SERVICE</span>	<span class="token constant">LAPTOP</span><span class="token operator">-</span><span class="token number">887</span><span class="token constant">GD1N2</span>	<span class="token number">8002</span>	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token constant">LAPTOP</span><span class="token operator">-</span><span class="token number">887</span><span class="token constant">GD1N2</span><span class="token operator">:</span><span class="token number">8002</span>
<span class="token constant">CLOUD</span><span class="token operator">-</span><span class="token constant">PAYMENT</span><span class="token operator">-</span><span class="token constant">SERVICE</span>	<span class="token constant">LAPTOP</span><span class="token operator">-</span><span class="token number">887</span><span class="token constant">GD1N2</span>	<span class="token number">8001</span>	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token constant">LAPTOP</span><span class="token operator">-</span><span class="token number">887</span><span class="token constant">GD1N2</span><span class="token operator">:</span><span class="token number">8001</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="eureka自我保护"><a href="#eureka自我保护" class="header-anchor">#</a> Eureka自我保护</h2> <blockquote><p>保护模式主要用于一组客户端和Eureka Server之间存在网络分区场景下的保护。一旦进入保护模式，Eureka Server将会尝试保护其服务注册表中的信息，不再删除服务注册表中的数据，也就是不会注销任何微服务。</p> <p>如果在Eureka Server的首页看到以下这段提示，则说明Eureka进入了保护模式：
EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEY'RE NOT.
RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE</p></blockquote> <p><img src="http://img.aismy.top/img/image-20220619164633380.png" alt="image-20220619164633380"></p> <h3 id="为什么会产生eureka自我保护机制"><a href="#为什么会产生eureka自我保护机制" class="header-anchor">#</a> 为什么会产生Eureka自我保护机制？</h3> <p>为了防止EurekaClient可以正常运行，但是 与 EurekaServer网络不通情况下，EurekaServer不会立刻将EurekaClient服务剔除</p> <h3 id="什么是自我保护模式"><a href="#什么是自我保护模式" class="header-anchor">#</a> 什么是自我保护模式？</h3> <p>默认情况下，如果EurekaServer在一定时间内没有接收到某个微服务实例的心跳，EurekaServer将会注销该实例（默认90秒）。但是当网络分区故障发生(延时、卡顿、拥挤)时，微服务与EurekaServer之间无法正常通信，以上行为可能变得非常危险了——因为微服务本身其实是健康的，此时本不应该注销这个微服务。Eureka通过“自我保护模式”来解决这个问题——当EurekaServer节点在短时间内丢失过多客户端时（可能发生了网络分区故障），那么这个节点就会进入自我保护模式。</p> <p>在自我保护模式中，Eureka Server会保护服务注册表中的信息，不再注销任何服务实例。
它的设计哲学就是宁可保留错误的服务注册信息，也不盲目注销任何可能健康的服务实例。一句话讲解：好死不如赖活着</p> <p>综上，自我保护模式是一种应对网络异常的安全保护措施。它的架构哲学是宁可同时保留所有微服务（健康的微服务和不健康的微服务都会保留）也不盲目注销任何健康的微服务。使用自我保护模式，可以让Eureka集群更加的健壮、稳定。</p> <blockquote><p>一句话：某时刻某一个微服务不可用了，Eureka不会立刻清理，依旧会对该微服务的信息进行保存</p> <p>属于CAP里面的AP分支</p></blockquote> <h3 id="怎么禁止自我保护"><a href="#怎么禁止自我保护" class="header-anchor">#</a> 怎么禁止自我保护</h3> <h4 id="注册中心eureakeserver端7001"><a href="#注册中心eureakeserver端7001" class="header-anchor">#</a> 注册中心eureakeServer端7001</h4> <p>出厂默认，自我保护机制是开启的 eureka.server.enable-self-preservation=true</p> <p>修改yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7001</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>server
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka7001.com
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment">#defaultZone: http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token comment">#关闭自我保护机制，保证不可用服务被及时踢除</span>
    <span class="token key atrule">enable-self-preservation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">eviction-interval-timer-in-ms</span><span class="token punctuation">:</span> <span class="token number">2000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>关闭之后效果</p> <p><img src="http://img.aismy.top/img/image-20220619165008503.png" alt="image-20220619165008503"></p> <h4 id="生产者客户端eureakeclient端8001"><a href="#生产者客户端eureakeclient端8001" class="header-anchor">#</a> 生产者客户端eureakeClient端8001</h4> <p>默认：eureka.instance.lease-renewal-interval-in-seconds=30     eureka.instance.lease-expiration-duration-in-seconds=90</p> <p>单位为秒(默认是90秒)</p> <p>修改yml</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span>
<span class="token comment">###服务名称(服务注册到eureka名称)</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>provider<span class="token punctuation">-</span>payment
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span> <span class="token comment">#服务提供者provider注册进eureka服务列表内</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001.com<span class="token punctuation">:</span>7001/eureka
<span class="token comment">#心跳检测与续约时间</span>
<span class="token comment">#开发时设置小些，保证服务关闭后注册中心能即使剔除服务</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
  <span class="token comment">#Eureka客户端向服务端发送心跳的时间间隔，单位为秒(默认是30秒)</span>
    <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token comment">#Eureka服务端在收到最后一次心跳后等待时间上限，单位为秒(默认是90秒)，超时将剔除服务</span>
    <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>测试</p> <p><img src="http://img.aismy.top/img/image-20220619165223538.png" alt="image-20220619165223538"></p> <p>关闭8001：在eureka中马上就被删除了</p> <p><img src="http://img.aismy.top/img/image-20220619165242290.png" alt="image-20220619165242290"></p> <h2 id="注册中心异同点"><a href="#注册中心异同点" class="header-anchor">#</a> 注册中心异同点</h2> <p><img src="http://img.aismy.top/img/image-20220619202147269.png" alt="image-20220619202147269"></p> <h2 id="cap理论"><a href="#cap理论" class="header-anchor">#</a> CAP理论</h2> <p>CAP理论关注粒度是数据，而不是整体系统设计的策略</p> <ul><li>C:Consistency（强一致性）</li> <li>A:Availability（可用性）</li> <li>P:Partition tolerance（分区容错性）</li></ul> <img src="http://img.aismy.top/img/image-20220619202306646.png" alt="image-20220619202306646" style="zoom:80%;"> <p><strong>AP架构（Eureka）</strong>
当网络分区出现后，为了保证<code>可用性</code>，系统B可以返回旧值，保证系统的可用性。
结论：违背了一致性C的要求，只满足可用性和分区容错，即AP</p> <p><img src="http://img.aismy.top/img/image-20220619202451325.png" alt="image-20220619202451325"></p> <p><strong>CP架构(Zookeeper/Consul)</strong>
当网络分区出现后，为了保证<code>一致性</code>，就必须拒接请求，否则无法保证一致性
结论：违背了可用性A的要求，只满足一致性和分区容错，即CP</p> <p><img src="http://img.aismy.top/img/image-20220619202559420.png" alt="image-20220619202559420"></p> <p>Eureka停更说明</p> <p><img src="http://img.aismy.top/img/image-20220619165442522.png" alt="image-20220619165442522"></p> <h1 id="ribbon"><a href="#ribbon" class="header-anchor">#</a> Ribbon</h1> <ul><li>https://blog.csdn.net/yeyinglingfeng/article/details/83860613?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=ribbon%E5%92%8Cresttemplate%E5%92%8Cfegin&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-83860613.142^v17^control,157^v15^new_3&amp;spm=1018.2226.3001.4187</li> <li>https://blog.csdn.net/zqn666/article/details/106856712?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165565074916781483711143%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=165565074916781483711143&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-106856712-null-null.142^v17^control,157^v15^new_3&amp;utm_term=ribbon%E5%92%8Cresttemplate%E5%92%8Cfegin&amp;spm=1018.2226.3001.4187</li> <li>https://blog.csdn.net/lettuce_/article/details/106378110?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165565074916781483711143%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=165565074916781483711143&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-106378110-null-null.142^v17^control,157^v15^new_3&amp;utm_term=ribbon%E5%92%8Cresttemplate%E5%92%8Cfegin&amp;spm=1018.2226.3001.4187</li></ul> <h2 id="服务调用几种方式"><a href="#服务调用几种方式" class="header-anchor">#</a> 服务调用几种方式</h2> <p>Httpclient
Okhttp
HttpURLConnection
RestTemplate</p> <h2 id="二、ribbon-resttemplate"><a href="#二、ribbon-resttemplate" class="header-anchor">#</a> 二、<a href="https://so.csdn.net/so/search?q=Ribbon&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Ribbon<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>+RestTemplate</h2> <h2 id="loadbalancer和ribbon"><a href="#loadbalancer和ribbon" class="header-anchor">#</a> loadbalancer和Ribbon</h2> <p>https://blog.csdn.net/qq_31856061/article/details/122026939?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=ribbon%E5%92%8Cloadbalancer%E7%9A%84%E5%8C%BA%E5%88%AB&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-5-122026939.142^v17^control,157^v15^new_3&amp;spm=1018.2226.3001.4187</p> <p>https://blog.csdn.net/qq_38050728/article/details/121924621?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-121924621-blog-122026939.pc_relevant_downloadblacklistv1&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-121924621-blog-122026939.pc_relevant_downloadblacklistv1&amp;utm_relevant_index=1</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Aismy/aismy.github.io/edit/master/docs/03.开发框架/03.SpringCloud/01.SpringCloud.md" target="_blank" rel="noopener noreferrer">在线编辑此文章</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/6b7be5/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">SpringBoot讲义</div></a> <a href="/pages/8c1c55/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">SpringCloudAlibaba</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/6b7be5/" class="prev">SpringBoot讲义</a></span> <span class="next"><a href="/pages/8c1c55/">SpringCloudAlibaba</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:752704491@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Aismy" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>Aismy | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b738e2cf.js" defer></script><script src="/assets/js/2.ffb45a81.js" defer></script><script src="/assets/js/29.aa305b1a.js" defer></script>
  </body>
</html>
